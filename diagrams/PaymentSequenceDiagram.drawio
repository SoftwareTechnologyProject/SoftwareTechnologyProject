<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" version="29.2.1">
  <diagram name="Payment Sequence Diagram" id="payment-sequence">
    <mxGraphModel dx="903" dy="408" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="1654" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="customer" parent="1" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;" value="Customer" vertex="1">
          <mxGeometry height="60" width="30" x="40" y="40" as="geometry" />
        </mxCell>
        <mxCell id="frontend" parent="1" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;" value="Frontend" vertex="1">
          <mxGeometry height="1200" width="100" x="160" y="40" as="geometry" />
        </mxCell>
        <mxCell id="controller" parent="1" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;" value=":PaymentController" vertex="1">
          <mxGeometry height="1200" width="120" x="320" y="40" as="geometry" />
        </mxCell>
        <mxCell id="service" parent="1" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;" value=":PaymentService" vertex="1">
          <mxGeometry height="1200" width="120" x="500" y="40" as="geometry" />
        </mxCell>
        <mxCell id="vnpay" parent="1" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;" value=":VNPayService" vertex="1">
          <mxGeometry height="1200" width="100" x="680" y="40" as="geometry" />
        </mxCell>
        <mxCell id="gateway" parent="1" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;" value="VNPay Gateway" vertex="1">
          <mxGeometry height="1200" width="100" x="840" y="40" as="geometry" />
        </mxCell>
        <mxCell id="db" parent="1" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;" value=":Database" vertex="1">
          <mxGeometry height="1200" width="100" x="1000" y="40" as="geometry" />
        </mxCell>
        <mxCell id="m1" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;entryX=0.483;entryY=0.084;entryDx=0;entryDy=0;entryPerimeter=0;" target="frontend" value="1: Select items &amp; click payment">
          <mxGeometry relative="1" width="80" x="0.0123" as="geometry">
            <mxPoint as="offset" />
            <mxPoint x="70" y="140" as="sourcePoint" />
            <mxPoint x="210" y="140" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m2" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="2: POST /payment/create">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="210" y="180" as="sourcePoint" />
            <mxPoint x="380" y="180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m3" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="3: initiatePaymentTransaction()">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="380" y="220" as="sourcePoint" />
            <mxPoint x="560" y="220" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m4" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="4: Validate cart items &amp; voucher">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="560" y="260" as="sourcePoint" />
            <mxPoint x="1050" y="260" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m5" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;" value="5: return paymentKey">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="560" y="300" as="sourcePoint" />
            <mxPoint x="380" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m6" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="6: createPaymentUrl()">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="380" y="340" as="sourcePoint" />
            <mxPoint x="730" y="340" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m7" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="7: calculateFinalAmount()">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="730" y="380" as="sourcePoint" />
            <mxPoint x="560" y="380" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m8" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;" value="8: return amount">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="560" y="420" as="sourcePoint" />
            <mxPoint x="730" y="420" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m9" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="9: Build VNPay params &amp; hash">
          <mxGeometry relative="1" width="80" as="geometry">
            <Array as="points">
              <mxPoint x="800" y="460" />
              <mxPoint x="800" y="480" />
            </Array>
            <mxPoint x="730" y="460" as="sourcePoint" />
            <mxPoint x="730" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m10" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;" value="10: return VNPay URL">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="730" y="520" as="sourcePoint" />
            <mxPoint x="380" y="520" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m11" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;" value="11: Redirect to VNPay">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="380" y="560" as="sourcePoint" />
            <mxPoint x="210" y="560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m12" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="12: Open payment page">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="210" y="600" as="sourcePoint" />
            <mxPoint x="890" y="600" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m13" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="13: Enter payment info">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="70" y="640" as="sourcePoint" />
            <mxPoint x="890" y="640" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m14" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="14: Process payment">
          <mxGeometry relative="1" width="80" as="geometry">
            <Array as="points">
              <mxPoint x="960" y="680" />
              <mxPoint x="960" y="700" />
            </Array>
            <mxPoint x="890" y="680" as="sourcePoint" />
            <mxPoint x="890" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="alt" parent="1" style="shape=umlFrame;whiteSpace=wrap;html=1;width=50;height=25;" value="alt" vertex="1">
          <mxGeometry height="420" width="1080" x="30" y="730" as="geometry" />
        </mxCell>
        <mxCell id="altSuccess" parent="1" style="text;html=1;align=left;verticalAlign=top;" value="[Payment Success]" vertex="1">
          <mxGeometry height="20" width="120" x="85" y="735" as="geometry" />
        </mxCell>
        <mxCell id="m15" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="15: Callback (ResponseCode=00)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="890" y="780" as="sourcePoint" />
            <mxPoint x="380" y="780" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m16" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="16: verifyCallback()">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="380" y="820" as="sourcePoint" />
            <mxPoint x="730" y="820" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m17" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;" value="17: return true">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="730" y="860" as="sourcePoint" />
            <mxPoint x="380" y="860" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m18" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="18: createOrderFromCart()">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="380" y="900" as="sourcePoint" />
            <mxPoint x="560" y="900" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m19" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="19: Create Order &amp; delete cart items">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="560" y="940" as="sourcePoint" />
            <mxPoint x="1050" y="940" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m20" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;" value="20: return Order">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="560" y="980" as="sourcePoint" />
            <mxPoint x="380" y="980" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m21" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;" value="21: Redirect to success page">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="380" y="1020" as="sourcePoint" />
            <mxPoint x="70" y="1020" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="div" parent="1" style="line;strokeWidth=1;dashed=1;" value="" vertex="1">
          <mxGeometry height="8" width="1080" x="30" y="1050" as="geometry" />
        </mxCell>
        <mxCell id="altFail" parent="1" style="text;html=1;align=left;verticalAlign=top;" value="[Payment Failed]" vertex="1">
          <mxGeometry height="20" width="120" x="85" y="1055" as="geometry" />
        </mxCell>
        <mxCell id="m22" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="22: Callback (ResponseCode!=00)">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="890" y="1090" as="sourcePoint" />
            <mxPoint x="380" y="1090" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m23" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;" value="23: cancelPayment()">
          <mxGeometry relative="1" width="80" as="geometry">
            <mxPoint x="380" y="1130" as="sourcePoint" />
            <mxPoint x="560" y="1130" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m24" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;" value="24: Redirect to error page">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="380" y="1170" as="sourcePoint" />
            <mxPoint x="70" y="1170" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="popDIa_Tj1gA7A88_Yiv-1" parent="1" style="rounded=0;whiteSpace=wrap;html=1;" value="Front end" vertex="1">
          <mxGeometry height="60" width="120" x="150" y="1230" as="geometry" />
        </mxCell>
        <mxCell id="popDIa_Tj1gA7A88_Yiv-2" parent="1" style="rounded=0;whiteSpace=wrap;html=1;" value="PaymentController" vertex="1">
          <mxGeometry height="60" width="120" x="320" y="1230" as="geometry" />
        </mxCell>
        <mxCell id="popDIa_Tj1gA7A88_Yiv-3" parent="1" style="rounded=0;whiteSpace=wrap;html=1;" value="PaymentService" vertex="1">
          <mxGeometry height="60" width="120" x="500" y="1230" as="geometry" />
        </mxCell>
        <mxCell id="popDIa_Tj1gA7A88_Yiv-4" parent="1" style="rounded=0;whiteSpace=wrap;html=1;" value="VNPayService" vertex="1">
          <mxGeometry height="60" width="120" x="670" y="1230" as="geometry" />
        </mxCell>
        <mxCell id="popDIa_Tj1gA7A88_Yiv-5" parent="1" style="rounded=0;whiteSpace=wrap;html=1;" value="VNPay Gateway" vertex="1">
          <mxGeometry height="60" width="120" x="830" y="1230" as="geometry" />
        </mxCell>
        <mxCell id="popDIa_Tj1gA7A88_Yiv-6" parent="1" style="rounded=0;whiteSpace=wrap;html=1;" value="DataBase" vertex="1">
          <mxGeometry height="60" width="120" x="990" y="1230" as="geometry" />
        </mxCell>
        <mxCell id="popDIa_Tj1gA7A88_Yiv-7" parent="1" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" value="Customer" vertex="1">
          <mxGeometry height="60" width="30" x="55" y="1230" as="geometry" />
        </mxCell>
        <mxCell id="popDIa_Tj1gA7A88_Yiv-11" edge="1" parent="1" source="popDIa_Tj1gA7A88_Yiv-7" style="endArrow=none;dashed=1;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="530" y="1220" as="sourcePoint" />
            <mxPoint x="70" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
